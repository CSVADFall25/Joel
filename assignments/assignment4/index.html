<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>EssentiaTest - Music Analysis Visualization</title>

    <link rel="stylesheet" type="text/css" href="style.css">

    <script src="libraries/p5.min.js"></script>
  </head>

  <body>
    <!-- Load Essentia.js modules -->
    <script>
      // Initialize Essentia.js when ready
      let essentia = null;
      let essentiaLoaded = false;
      
      // Load Essentia.js
      const script1 = document.createElement('script');
      script1.src = 'https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia-wasm.web.js';
      script1.onload = () => {
        console.log('Essentia WASM loaded');
        
        const script2 = document.createElement('script');
        script2.src = 'https://cdn.jsdelivr.net/npm/essentia.js@0.1.3/dist/essentia.js-core.js';
        script2.onload = () => {
          console.log('Essentia core loaded');
          essentiaLoaded = true;
          
          // Initialize Essentia
          try {
            if (typeof EssentiaWASM !== 'undefined' && typeof EssentiaJS !== 'undefined') {
              const essentiaWASM = new EssentiaWASM();
              essentia = new EssentiaJS(essentiaWASM);
              console.log('Essentia.js initialized globally');
            }
          } catch (e) {
            console.warn('Failed to initialize Essentia.js:', e);
          }
        };
        document.head.appendChild(script2);
      };
      document.head.appendChild(script1);
    </script>
    
    <!-- Application modules -->
    <script src="js/AudioManager.js"></script>
    <script src="js/EssentiaAnalyzer.js"></script>
    <script src="js/AudioPlayerUI.js"></script>
    <script src="sketch.js"></script>
  </body>
</html>
